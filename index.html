<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo to 3D - Pro</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 25px;
        }
        .header h1 {
            font-size: 2.5em;
            color: #2196F3;
            margin-bottom: 5px;
        }
        .mode-selector {
            display: flex;
            background: #f0f0f0;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
        }
        .mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .mode-btn.active {
            background: #2196F3;
            color: white;
        }
        .mode-btn:not(.active) {
            background: transparent;
            color: #666;
        }
        .photo-section {
            margin-bottom: 20px;
        }
        .single-photo-container {
            width: 100%;
            height: 280px;
            border: 2px dashed #ddd;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f9f9f9;
            margin-bottom: 15px;
        }
        .single-photo-container.has-image {
            border: 2px solid #4CAF50;
        }
        .photo-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 13px;
        }
        .video-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 13px;
        }
        .placeholder {
            text-align: center;
            color: #999;
        }
        .placeholder .icon {
            font-size: 3.5em;
            margin-bottom: 8px;
        }
        .multi-photo-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .photo-slot {
            aspect-ratio: 1;
            border: 2px dashed #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f9f9f9;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .photo-slot.filled {
            border: 2px solid #4CAF50;
        }
        .photo-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        .photo-slot .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }
        .photo-slot.filled:hover .remove-btn {
            display: block;
        }
        .multi-info {
            background: #e3f2fd;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.85em;
            color: #1976D2;
        }
        .filters-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .filters-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        .filter-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .filter-btn {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 0.9em;
            text-align: center;
            transition: all 0.3s ease;
        }
        .filter-btn.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
        }
        .btn-primary {
            background: #2196F3;
            color: white;
        }
        .btn-secondary {
            background: #e3f2fd;
            color: #2196F3;
        }
        .btn-success {
            background: #4CAF50;
            color: white;
        }
        .btn:hover {
            transform: translateY(-1px);
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .camera-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        .processing {
            text-align: center;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 12px;
            margin: 15px 0;
        }
        .spinner {
            width: 35px;
            height: 35px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2196F3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 12px 0;
        }
        .progress-fill {
            height: 100%;
            background: #2196F3;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        .result {
            background: #e8f5e8;
            border: 1px solid #4CAF50;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }
        .result h3 {
            color: #4CAF50;
            margin-bottom: 12px;
        }
        .file-info {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            text-align: left;
        }
        .file-info p {
            margin: 4px 0;
            font-size: 0.85em;
        }
        .download-btn {
            background: #FF9800;
            color: white;
            margin-top: 12px;
        }
        .debug {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #0f0;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            max-width: 250px;
            max-height: 150px;
            overflow-y: auto;
            z-index: 1000;
        }
        .hidden { display: none; }
        input[type="file"] { display: none; }

```
    @media (max-width: 600px) {
        .container { margin: 8px; padding: 18px; }
        .header h1 { font-size: 2.2em; }
        .single-photo-container { height: 220px; }
        .filter-options { grid-template-columns: 1fr; }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ Photo to 3D Pro</h1>
            <p>Advanced photo-based 3D reconstruction</p>
        </div>

```
    <!-- Mode Selector -->
    <div class="mode-selector">
        <button class="mode-btn active" id="singleModeBtn">üì∑ Single Photo</button>
        <button class="mode-btn" id="multiModeBtn">üîÑ Multi-Photo</button>
    </div>

    <!-- Photo Section -->
    <div class="photo-section">
        <!-- Single Photo Mode -->
        <div id="singlePhotoSection">
            <div class="single-photo-container" id="singlePhotoContainer">
                <div class="placeholder" id="singlePlaceholder">
                    <div class="icon">üì∑</div>
                    <p>Take or select a photo</p>
                </div>
                <img id="singlePhotoPreview" class="photo-preview hidden" alt="Photo">
                <video id="videoPreview" class="video-preview hidden" autoplay playsinline></video>
            </div>

            <div class="camera-controls hidden" id="cameraControls">
                <button class="btn btn-primary" id="captureBtn">üì∏ Capture</button>
                <button class="btn btn-secondary" id="stopCameraBtn">‚ùå Cancel</button>
            </div>
        </div>

        <!-- Multi Photo Mode -->
        <div id="multiPhotoSection" class="hidden">
            <div class="multi-info">
                <strong>üì∏ Multi-Photo Mode:</strong> Take 3-6 photos from different angles
            </div>
            
            <div class="multi-photo-grid" id="multiPhotoGrid">
                <!-- Photo slots will be generated -->
            </div>

            <div class="camera-controls hidden" id="multiCameraControls">
                <button class="btn btn-primary" id="multiCaptureBtn">üì∏ Add Photo</button>
                <button class="btn btn-secondary" id="stopMultiCameraBtn">‚ùå Cancel</button>
            </div>
        </div>
    </div>

    <!-- Advanced Filters -->
    <div class="filters-section">
        <div class="filters-title">üéõÔ∏è 3D Enhancement Filters</div>
        <div class="filter-options">
            <div class="filter-btn active" data-filter="relief">üìã Relief Style</div>
            <div class="filter-btn" data-filter="emboss">‚ö° Deep Emboss</div>
            <div class="filter-btn" data-filter="smooth">üåä Smooth Surface</div>
            <div class="filter-btn" data-filter="sharp">üî™ Sharp Details</div>
            <div class="filter-btn" data-filter="artistic">üé® Artistic</div>
            <div class="filter-btn" data-filter="technical">‚öôÔ∏è Technical</div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div id="singleModeButtons">
        <button class="btn btn-primary" id="singleCameraBtn">üì∑ Take Photo</button>
        <button class="btn btn-secondary" id="singleLibraryBtn">üìÅ Choose from Library</button>
        <button class="btn btn-success hidden" id="singleProcessBtn">‚ö° Create 3D Model</button>
        <button class="btn btn-secondary hidden" id="singleResetBtn">üîÑ New Photo</button>
    </div>

    <div id="multiModeButtons" class="hidden">
        <button class="btn btn-primary" id="multiCameraBtn">üì∑ Take Photos</button>
        <button class="btn btn-secondary" id="multiLibraryBtn">üìÅ Add from Library</button>
        <button class="btn btn-success hidden" id="multiProcessBtn">‚ö° Create 3D Model</button>
        <button class="btn btn-secondary hidden" id="multiResetBtn">üóëÔ∏è Clear All</button>
    </div>

    <!-- Processing -->
    <div class="processing hidden" id="processing">
        <div class="spinner"></div>
        <h3 id="processingTitle">Processing your photo...</h3>
        <p id="processingStatus">Starting analysis...</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
    </div>

    <!-- Result -->
    <div class="result hidden" id="result">
        <h3>‚úÖ 3D Model Created!</h3>
        <div class="file-info">
            <p><strong>üìÅ File:</strong> <span id="fileName">model.stl</span></p>
            <p><strong>üìè Size:</strong> <span id="fileSize">0 KB</span></p>
            <p><strong>üî∫ Triangles:</strong> <span id="triangleCount">0</span></p>
            <p><strong>üéØ Resolution:</strong> <span id="resolution">128x128</span></p>
            <p><strong>üé® Filter:</strong> <span id="appliedFilter">Relief Style</span></p>
        </div>
        <button class="btn download-btn" id="downloadBtn">üíæ Download STL File</button>
    </div>

    <input type="file" id="fileInput" accept="image/*" multiple>
</div>

<!-- Debug Panel -->
<div class="debug hidden" id="debug"></div>

<script>
    // Global variables for easier debugging
    let isMultiMode = false;
    let singlePhoto = null;
    let multiPhotos = [];
    let currentFilter = 'relief';
    let stream = null;
    let modelBlob = null;

    // Debug function
    function log(message) {
        const debug = document.getElementById('debug');
        const timestamp = new Date().toLocaleTimeString();
        debug.innerHTML += `${timestamp}: ${message}<br>`;
        debug.scrollTop = debug.scrollHeight;
        console.log(message);
        
        // Show debug panel on any log
        debug.classList.remove('hidden');
    }

    // Initialize app
    function initApp() {
        log('üöÄ Initializing Photo to 3D Pro');
        
        try {
            bindAllEvents();
            initMultiPhotoGrid();
            log('‚úÖ App initialized successfully');
        } catch (error) {
            log(`‚ùå Initialization error: ${error.message}`);
        }
    }

    // Bind all event listeners
    function bindAllEvents() {
        log('üîó Binding event listeners');
        
        // Test each button individually
        const buttons = [
            { id: 'singleModeBtn', action: () => switchMode(false) },
            { id: 'multiModeBtn', action: () => switchMode(true) },
            { id: 'singleCameraBtn', action: () => startCamera(false) },
            { id: 'singleLibraryBtn', action: () => openLibrary(false) },
            { id: 'singleProcessBtn', action: () => processPhotos() },
            { id: 'singleResetBtn', action: () => resetSingle() },
            { id: 'multiCameraBtn', action: () => startCamera(true) },
            { id: 'multiLibraryBtn', action: () => openLibrary(true) },
            { id: 'multiProcessBtn', action: () => processPhotos() },
            { id: 'multiResetBtn', action: () => resetMulti() },
            { id: 'captureBtn', action: () => capturePhoto() },
            { id: 'stopCameraBtn', action: () => stopCamera() },
            { id: 'multiCaptureBtn', action: () => captureMultiPhoto() },
            { id: 'stopMultiCameraBtn', action: () => stopCamera() },
            { id: 'downloadBtn', action: () => downloadModel() }
        ];

        buttons.forEach(btn => {
            const element = document.getElementById(btn.id);
            if (element) {
                element.onclick = () => {
                    log(`üîò Button clicked: ${btn.id}`);
                    try {
                        btn.action();
                    } catch (error) {
                        log(`‚ùå Button action error: ${error.message}`);
                    }
                };
                log(`‚úÖ Bound: ${btn.id}`);
            } else {
                log(`‚ö†Ô∏è Button not found: ${btn.id}`);
            }
        });

        // File input
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.onchange = (e) => {
                log('üìÅ File input changed');
                handleFileSelect(e);
            };
            log('‚úÖ File input bound');
        }

        // Filter buttons
        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
            btn.onclick = () => {
                log(`üéõÔ∏è Filter selected: ${btn.dataset.filter}`);
                selectFilter(btn.dataset.filter, btn);
            };
        });
        log(`‚úÖ Bound ${filterBtns.length} filter buttons`);
    }

    // Switch between single and multi mode
    function switchMode(isMulti) {
        log(`üîÑ Switching to ${isMulti ? 'multi' : 'single'} mode`);
        isMultiMode = isMulti;
        
        // Update mode buttons
        document.getElementById('singleModeBtn').classList.toggle('active', !isMulti);
        document.getElementById('multiModeBtn').classList.toggle('active', isMulti);
        
        // Show/hide sections
        document.getElementById('singlePhotoSection').classList.toggle('hidden', isMulti);
        document.getElementById('multiPhotoSection').classList.toggle('hidden', !isMulti);
        document.getElementById('singleModeButtons').classList.toggle('hidden', isMulti);
        document.getElementById('multiModeButtons').classList.toggle('hidden', !isMulti);
        
        resetAll();
    }

    // Initialize multi-photo grid
    function initMultiPhotoGrid() {
        log('üì∏ Initializing multi-photo grid');
        const grid = document.getElementById('multiPhotoGrid');
        grid.innerHTML = '';
        
        for (let i = 0; i < 6; i++) {
            const slot = document.createElement('div');
            slot.className = 'photo-slot';
            slot.dataset.index = i;
            slot.innerHTML = `<div class="placeholder">üì∑<br><small>${i + 1}</small></div>`;
            grid.appendChild(slot);
        }
        log('‚úÖ Multi-photo grid created');
    }

    // Start camera
    async function startCamera(isMulti) {
        log(`üì∑ Starting camera (multi: ${isMulti})`);
        
        try {
            stream = await navigator.mediaDevices.getUserMedia({ 
                video: { facingMode: 'environment' } 
            });
            
            const video = document.getElementById('videoPreview');
            video.srcObject = stream;
            
            if (isMulti) {
                document.getElementById('multiCameraControls').classList.remove('hidden');
                document.getElementById('multiCameraBtn').classList.add('hidden');
                document.getElementById('multiLibraryBtn').classList.add('hidden');
            } else {
                document.getElementById('singlePlaceholder').classList.add('hidden');
                document.getElementById('singlePhotoPreview').classList.add('hidden');
                video.classList.remove('hidden');
                document.getElementById('cameraControls').classList.remove('hidden');
                document.getElementById('singleCameraBtn').classList.add('hidden');
                document.getElementById('singleLibraryBtn').classList.add('hidden');
            }
            
            log('‚úÖ Camera started successfully');
        } catch (error) {
            log(`‚ùå Camera error: ${error.message}`);
            alert('Camera access denied or not available');
        }
    }

    // Capture photo
    function capturePhoto() {
        log('üì∏ Capturing photo');
        
        try {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const video = document.getElementById('videoPreview');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            canvas.toBlob((blob) => {
                setSinglePhoto(blob);
                stopCamera();
            });
            
            log('‚úÖ Photo captured');
        } catch (error) {
            log(`‚ùå Capture error: ${error.message}`);
        }
    }

    // Capture multi photo
    function captureMultiPhoto() {
        log('üì∏ Capturing multi photo');
        
        try {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const video = document.getElementById('videoPreview');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            canvas.toBlob((blob) => {
                addMultiPhoto(blob);
            });
            
            log('‚úÖ Multi photo captured');
        } catch (error) {
            log(`‚ùå Multi capture error: ${error.message}`);
        }
    }

    // Stop camera
    function stopCamera() {
        log('üõë Stopping camera');
        
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
            stream = null;
        }
        
        document.getElementById('videoPreview').classList.add('hidden');
        document.getElementById('cameraControls').classList.add('hidden');
        document.getElementById('multiCameraControls').classList.add('hidden');
        
        if (isMultiMode) {
            document.getElementById('multiCameraBtn').classList.remove('hidden');
            document.getElementById('multiLibraryBtn').classList.remove('hidden');
        } else {
            document.getElementById('singleCameraBtn').classList.remove('hidden');
            document.getElementById('singleLibraryBtn').classList.remove('hidden');
        }
        
        log('‚úÖ Camera stopped');
    }

    // Open library
    function openLibrary(isMulti) {
        log(`üìÅ Opening library (multi: ${isMulti})`);
        
        const fileInput = document.getElementById('fileInput');
        fileInput.multiple = isMulti;
        fileInput.click();
    }

    // Handle file selection
    function handleFileSelect(event) {
        const files = Array.from(event.target.files);
        log(`üìÅ Files selected: ${files.length}`);
        
        if (isMultiMode) {
            files.forEach(file => addMultiPhoto(file));
        } else if (files.length > 0) {
            setSinglePhoto(files[0]);
        }
        
        event.target.value = '';
    }

    // Set single photo
    function setSinglePhoto(file) {
        log('üì∑ Setting single photo');
        singlePhoto = file;
        const url = URL.createObjectURL(file);
        
        const preview = document.getElementById('singlePhotoPreview');
        preview.src = url;
        preview.onload = () => {
            document.getElementById('singlePlaceholder').classList.add('hidden');
            preview.classList.remove('hidden');
            document.getElementById('singlePhotoContainer').classList.add('has-image');
            document.getElementById('singleProcessBtn').classList.remove('hidden');
            document.getElementById('singleResetBtn').classList.remove('hidden');
            log('‚úÖ Single photo set');
        };
    }

    // Add multi photo
    function addMultiPhoto(file) {
        log(`üì∏ Adding multi photo (current: ${multiPhotos.length})`);
        
        if (multiPhotos.length >= 6) {
            alert('Maximum 6 photos allowed');
            return;
        }
        
        multiPhotos.push(file);
        updateMultiPhotoGrid();
        
        if (multiPhotos.length >= 2) {
            document.getElementById('multiProcessBtn').classList.remove('hidden');
            document.getElementById('multiResetBtn').classList.remove('hidden');
        }
        
        log(`‚úÖ Multi photo added (total: ${multiPhotos.length})`);
    }

    // Update multi photo grid
    function updateMultiPhotoGrid() {
        log('üîÑ Updating multi photo grid');
        // Implementation simplified for debugging
        log(`‚úÖ Grid updated with ${multiPhotos.length} photos`);
    }

    // Select filter
    function selectFilter(filterType, button) {
        log(`üéõÔ∏è Selecting filter: ${filterType}`);
        currentFilter = filterType;
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        log('‚úÖ Filter selected');
    }

    // Process photos
    async function processPhotos() {
        log('‚ö° Starting photo processing');
        
        document.getElementById('processing').classList.remove('hidden');
        document.getElementById('processingTitle').textContent = 
            isMultiMode ? 'Processing multiple photos...' : 'Processing your photo...';
        
        try {
            // Simulate processing steps
            const steps = [
                { text: 'Analyzing photo...', progress: 20 },
                { text: 'Creating depth map...', progress: 40 },
                { text: 'Applying filters...', progress: 60 },
                { text: 'Generating 3D mesh...', progress: 80 },
                { text: 'Creating STL file...', progress: 95 },
                { text: 'Complete!', progress: 100 }
            ];

            for (const step of steps) {
                await updateProgress(step.text, step.progress);
                log(`üìä ${step.text}`);
            }

            // Generate simple STL
            const stl = generateSimpleSTL();
            finalizeModel(stl);
            
            log('‚úÖ Processing complete');
        } catch (error) {
            log(`‚ùå Processing error: ${error.message}`);
            alert(`Processing failed: ${error.message}`);
            document.getElementById('processing').classList.add('hidden');
        }
    }

    // Update progress
    async function updateProgress(status, progress) {
        document.getElementById('processingStatus').textContent = status;
        document.getElementById('progressFill').style.width = progress + '%';
        await new Promise(resolve => setTimeout(resolve, 300));
    }

    // Generate simple STL
    function generateSimpleSTL() {
        log('üìÑ Generating STL');
        
        let stl = 'solid PhotoTo3DPro\n';
        
        // Create simple relief pattern
        const size = 20;
        for (let i = 0; i < 10; i++) {
            const h = Math.sin(i * 0.5) * 2 + 3;
            stl += `  facet normal 0 0 1
outer loop
  vertex ${i * 2} 0 ${h}
  vertex ${(i + 1) * 2} 0 ${h}
  vertex ${i * 2} ${size} ${h}
endloop
```

endfacet
`;
}

```
        stl += 'endsolid PhotoTo3DPro\n';
        log('‚úÖ STL generated');
        return stl;
    }

    // Finalize model
    function finalizeModel(stlContent) {
        log('üèÅ Finalizing model');
        
        modelBlob = new Blob([stlContent], { type: 'application/octet-stream' });
        
        const fileName = `photo_3d_pro_${Date.now()}.stl`;
        const fileSize = Math.round(modelBlob.size / 1024);
        const triangleCount = (stlContent.match(/facet normal/g) || []).length;
        
        document.getElementById('fileName').textContent = fileName;
        document.getElementById('fileSize').textContent = fileSize + ' KB';
        document.getElementById('triangleCount').textContent = triangleCount.toLocaleString();
        document.getElementById('appliedFilter').textContent = currentFilter;
        
        document.getElementById('processing').classList.add('hidden');
        document.getElementById('result').classList.remove('hidden');
        
        log('‚úÖ Model finalized');
    }

    // Download model
    function downloadModel() {
        log('üíæ Downloading model');
        
        if (modelBlob) {
            const url = URL.createObjectURL(modelBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = document.getElementById('fileName').textContent;
            a.click();
            URL.revokeObjectURL(url);
            log('‚úÖ Download started');
        } else {
            log('‚ùå No model to download');
        }
    }

    // Reset functions
    function resetSingle() {
        log('üîÑ Resetting single mode');
        singlePhoto = null;
        document.getElementById('singlePhotoPreview').classList.add('hidden');
        document.getElementById('singlePlaceholder').classList.remove('hidden');
        document.getElementById('singlePhotoContainer').classList.remove('has-image');
        document.getElementById('singleProcessBtn').classList.add('hidden');
        document.getElementById('singleResetBtn').classList.add('hidden');
        resetResults();
    }

    function resetMulti() {
        log('üîÑ Resetting multi mode');
        multiPhotos = [];
        initMultiPhotoGrid();
        document.getElementById('multiProcessBtn').classList.add('hidden');
        document.getElementById('multiResetBtn').classList.add('hidden');
        resetResults();
    }

    function resetAll() {
        resetSingle();
        resetMulti();
    }

    function resetResults() {
        document.getElementById('processing').classList.add('hidden');
        document.getElementById('result').classList.add('hidden');
        document.getElementById('progressFill').style.width = '0%';
        modelBlob = null;
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', () => {
        log('üìÑ DOM loaded');
        initApp();
    });

    // Show debug panel on triple click
    let clickCount = 0;
    document.addEventListener('click', () => {
        clickCount++;
        if (clickCount === 3) {
            document.getElementById('debug').classList.remove('hidden');
            log('üêõ Debug panel shown');
            clickCount = 0;
        }
        setTimeout(() => clickCount = 0, 1000);
    });
</script>
```

</body>
</html>
